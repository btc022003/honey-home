import{l as ge,a as ve,d as ke}from"./shop-carts.cf7830fa.js";import{u as Se,d as Ce,T as Pe}from"./request.83988c84.js";import{O as ne,W as J,n as y,d as A,y as se,aw as xe,t as E,r as _,b as C,k as d,I as ue,x as Y,c as M,u as Ve,w as D,ax as Z,ay as ye,v as Te,a4 as _e,D as Q,s as H,m as I,ac as Be,U as q,V as K,a0 as ae,at as le,S as U,l as pe,$ as re,az as we,ak as Ie,a as Ee,aA as $e,j as Le,ag as Ae,q as Ne,F as j,G as oe,K as Fe,L as De,H as w,J as V,M as Me,a9 as ie,N as Re,aB as Ge}from"./index.e001e466.js";import{B as de}from"./index.eb161ab0.js";import{u as ee,r as ze,p as O}from"./index.c04ac7c9.js";import{C as We}from"./index.ebe7e0af.js";const me={name:ne,shape:J("round"),disabled:Boolean,iconSize:y,modelValue:ne,checkedColor:String,labelPosition:String,labelDisabled:Boolean};var Oe=A({props:se({},me,{bem:xe(Function),role:String,parent:Object,checked:Boolean,bindGroup:E}),emits:["click","toggle"],setup(e,{emit:u,slots:s}){const m=_(),h=n=>{if(e.parent&&e.bindGroup)return e.parent.props[n]},f=C(()=>h("disabled")||e.disabled),r=C(()=>h("direction")),i=C(()=>{const n=e.checkedColor||h("checkedColor");if(n&&e.checked&&!f.value)return{borderColor:n,backgroundColor:n}}),g=n=>{const{target:o}=n,v=m.value,P=v===o||(v==null?void 0:v.contains(o));!f.value&&(P||!e.labelDisabled)&&u("toggle"),u("click",n)},a=()=>{const{bem:n,shape:o,checked:v}=e,P=e.iconSize||h("iconSize");return d("div",{ref:m,class:n("icon",[o,{disabled:f.value,checked:v}]),style:{fontSize:Y(P)}},[s.icon?s.icon({checked:v,disabled:f.value}):d(ue,{name:"success",style:i.value},null)])},l=()=>{if(s.default)return d("span",{class:e.bem("label",[e.labelPosition,{disabled:f.value}])},[s.default()])};return()=>{const n=e.labelPosition==="left"?[l(),a()]:[a(),l()];return d("div",{role:e.role,class:e.bem([{disabled:f.value,"label-disabled":e.labelDisabled},r.value]),tabindex:f.value?void 0:0,"aria-checked":e.checked,onClick:g},[n])}}});const[fe,Ue]=M("checkbox-group"),He={max:y,disabled:Boolean,iconSize:y,direction:String,modelValue:ye(),checkedColor:String},be=Symbol(fe);A({name:fe,props:He,emits:["change","update:modelValue"],setup(e,{emit:u,slots:s}){const{children:m,linkChildren:h}=Ve(be),f=i=>u("update:modelValue",i),r=(i={})=>{typeof i=="boolean"&&(i={checked:i});const{checked:g,skipDisabled:a}=i,n=m.filter(o=>o.props.bindGroup?o.props.disabled&&a?o.checked.value:g!=null?g:!o.checked.value:!1).map(o=>o.name);f(n)};return D(()=>e.modelValue,i=>u("change",i)),ee({toggleAll:r}),Z(()=>e.modelValue),h({props:e,updateValue:f}),()=>{var i;return d("div",{class:Ue([e.direction])},[(i=s.default)==null?void 0:i.call(s)])}}});const[qe,Ke]=M("checkbox"),je=se({},me,{bindGroup:E});var Xe=A({name:qe,props:je,emits:["change","update:modelValue"],setup(e,{emit:u,slots:s}){const{parent:m}=Te(be),h=i=>{const{name:g}=e,{max:a,modelValue:l}=m.props,n=l.slice();if(i)!(a&&n.length>=a)&&!n.includes(g)&&(n.push(g),e.bindGroup&&m.updateValue(n));else{const o=n.indexOf(g);o!==-1&&(n.splice(o,1),e.bindGroup&&m.updateValue(n))}},f=C(()=>m&&e.bindGroup?m.props.modelValue.indexOf(e.name)!==-1:!!e.modelValue),r=(i=!f.value)=>{m&&e.bindGroup?h(i):u("update:modelValue",i)};return D(()=>e.modelValue,i=>u("change",i)),ee({toggle:r,props:e,checked:f}),Z(()=>e.modelValue),()=>d(Oe,Q({bem:Ke,role:"checkbox",parent:m,checked:f.value,onToggle:r},e),_e(s,["default","icon"]))}});const ce=H(Xe),[Je,z]=M("stepper"),Ye=200,Qe=600,W=(e,u)=>String(e)===String(u),Ze={min:I(1),max:I(1/0),name:I(""),step:I(1),theme:String,integer:Boolean,disabled:Boolean,showPlus:E,showMinus:E,showInput:E,longPress:E,allowEmpty:Boolean,modelValue:y,inputWidth:y,buttonSize:y,placeholder:String,disablePlus:Boolean,disableMinus:Boolean,disableInput:Boolean,beforeChange:Function,defaultValue:I(1),decimalLength:y};var et=A({name:Je,props:Ze,emits:["plus","blur","minus","focus","change","overlimit","update:modelValue"],setup(e,{emit:u}){const s=t=>{const{min:b,max:k,allowEmpty:p,decimalLength:S}=e;return p&&t===""||(t=le(String(t),!e.integer),t=t===""?0:+t,t=Number.isNaN(t)?+b:t,t=Math.max(Math.min(+k,t),+b),U(S)&&(t=t.toFixed(+S))),t},m=()=>{var t;const b=(t=e.modelValue)!=null?t:e.defaultValue,k=s(b);return W(k,e.modelValue)||u("update:modelValue",k),k};let h;const f=_(),r=_(m()),i=C(()=>e.disabled||e.disableMinus||r.value<=+e.min),g=C(()=>e.disabled||e.disablePlus||r.value>=+e.max),a=C(()=>({width:Y(e.inputWidth),height:Y(e.buttonSize)})),l=C(()=>Be(e.buttonSize)),n=()=>{const t=s(r.value);W(t,r.value)||(r.value=t)},o=t=>{e.beforeChange?re(e.beforeChange,{args:[t],done(){r.value=t}}):r.value=t},v=()=>{if(h==="plus"&&g.value||h==="minus"&&i.value){u("overlimit",h);return}const t=h==="minus"?-e.step:+e.step,b=s(we(+r.value,t));o(b),u(h)},P=t=>{const b=t.target,{value:k}=b,{decimalLength:p}=e;let S=le(String(k),!e.integer);if(U(p)&&S.includes(".")){const te=S.split(".");S=`${te[0]}.${te[1].slice(0,+p)}`}e.beforeChange?b.value=String(r.value):W(k,S)||(b.value=S);const he=S===String(+S);o(he?+S:S)},T=t=>{var b;e.disableInput?(b=f.value)==null||b.blur():u("focus",t)},$=t=>{const b=t.target,k=s(b.value);b.value=String(k),r.value=k,pe(()=>{u("blur",t),ze()})};let B,L;const N=()=>{L=setTimeout(()=>{v(),N()},Ye)},R=()=>{e.longPress&&(B=!1,clearTimeout(L),L=setTimeout(()=>{B=!0,v(),N()},Qe))},F=t=>{e.longPress&&(clearTimeout(L),B&&O(t))},G=t=>{e.disableInput&&O(t)},c=t=>({onClick:b=>{O(b),h=t,v()},onTouchstartPassive:()=>{h=t,R()},onTouchend:F,onTouchcancel:F});return D(()=>[e.max,e.min,e.integer,e.decimalLength],n),D(()=>e.modelValue,t=>{W(t,r.value)||(r.value=s(t))}),D(r,t=>{u("update:modelValue",t),u("change",t,{name:e.name})}),Z(()=>e.modelValue),()=>d("div",{role:"group",class:z([e.theme])},[q(d("button",Q({type:"button",style:l.value,class:[z("minus",{disabled:i.value}),{[ae]:!i.value}],"aria-disabled":i.value||void 0},c("minus")),null),[[K,e.showMinus]]),q(d("input",{ref:f,type:e.integer?"tel":"text",role:"spinbutton",class:z("input"),value:r.value,style:a.value,disabled:e.disabled,readonly:e.disableInput,inputmode:e.integer?"numeric":"decimal",placeholder:e.placeholder,"aria-valuemax":e.max,"aria-valuemin":e.min,"aria-valuenow":r.value,onBlur:$,onInput:P,onFocus:T,onMousedown:G},null),[[K,e.showInput]]),q(d("button",Q({type:"button",style:l.value,class:[z("plus",{disabled:g.value}),{[ae]:!g.value}],"aria-disabled":g.value||void 0},c("plus")),null),[[K,e.showPlus]])])}});const tt=H(et),[nt,x,at]=M("submit-bar"),lt={tip:String,label:String,price:Number,tipIcon:String,loading:Boolean,currency:J("\xA5"),disabled:Boolean,textAlign:String,buttonText:String,buttonType:J("danger"),buttonColor:String,suffixLabel:String,placeholder:Boolean,decimalLength:I(2),safeAreaInsetBottom:E};var ot=A({name:nt,props:lt,emits:["submit"],setup(e,{emit:u,slots:s}){const m=_(),h=Ie(m,x),f=()=>{const{price:l,label:n,currency:o,textAlign:v,suffixLabel:P,decimalLength:T}=e;if(typeof l=="number"){const $=(l/100).toFixed(+T).split("."),B=T?`.${$[1]}`:"";return d("div",{class:x("text"),style:{textAlign:v}},[d("span",null,[n||at("label")]),d("span",{class:x("price")},[o,d("span",{class:x("price-integer")},[$[0]]),B]),P&&d("span",{class:x("suffix-label")},[P])])}},r=()=>{var l;const{tip:n,tipIcon:o}=e;if(s.tip||n)return d("div",{class:x("tip")},[o&&d(ue,{class:x("tip-icon"),name:o},null),n&&d("span",{class:x("tip-text")},[n]),(l=s.tip)==null?void 0:l.call(s)])},i=()=>u("submit"),g=()=>s.button?s.button():d(de,{round:!0,type:e.buttonType,text:e.buttonText,class:x("button",e.buttonType),color:e.buttonColor,loading:e.loading,disabled:e.disabled,onClick:i},null),a=()=>{var l,n;return d("div",{ref:m,class:[x(),{"van-safe-area-bottom":e.safeAreaInsetBottom}]},[(l=s.top)==null?void 0:l.call(s),r(),d("div",{class:x("bar")},[(n=s.default)==null?void 0:n.call(s),f(),g()])])};return()=>e.placeholder?h(a):a()}});const it=H(ot),[ct,X]=M("swipe-cell"),st={name:I(""),disabled:Boolean,leftWidth:y,rightWidth:y,beforeClose:Function,stopPropagation:Boolean};var ut=A({name:ct,props:st,emits:["open","close","click"],setup(e,{emit:u,slots:s}){let m,h,f;const r=_(),i=_(),g=_(),a=Ee({offset:0,dragging:!1}),l=Se(),n=c=>c.value?Ae(c).width:0,o=C(()=>U(e.leftWidth)?+e.leftWidth:n(i)),v=C(()=>U(e.rightWidth)?+e.rightWidth:n(g)),P=c=>{a.offset=c==="left"?o.value:-v.value,m||(m=!0,u("open",{name:e.name,position:c}))},T=c=>{a.offset=0,m&&(m=!1,u("close",{name:e.name,position:c}))},$=c=>{const t=Math.abs(a.offset),b=.15,k=m?1-b:b,p=c==="left"?o.value:v.value;p&&t>p*k?P(c):T(c)},B=c=>{e.disabled||(f=a.offset,l.start(c))},L=c=>{if(e.disabled)return;const{deltaX:t}=l;l.move(c),l.isHorizontal()&&(h=!0,a.dragging=!0,(!m||t.value*f<0)&&O(c,e.stopPropagation),a.offset=Ne(t.value+f,-v.value,o.value))},N=()=>{a.dragging&&(a.dragging=!1,$(a.offset>0?"left":"right"),setTimeout(()=>{h=!1},0))},R=(c="outside")=>{u("click",c),m&&!h&&re(e.beforeClose,{args:[{name:e.name,position:c}],done:()=>T(c)})},F=(c,t)=>b=>{t&&b.stopPropagation(),R(c)},G=(c,t)=>{const b=s[c];if(b)return d("div",{ref:t,class:X(c),onClick:F(c,!0)},[b()])};return ee({open:P,close:T}),$e(r,()=>R("outside"),{eventName:"touchstart"}),Le("touchmove",L,{target:r}),()=>{var c;const t={transform:`translate3d(${a.offset}px, 0, 0)`,transitionDuration:a.dragging?"0s":".6s"};return d("div",{ref:r,class:X(),onClick:F("cell",h),onTouchstartPassive:B,onTouchend:N,onTouchcancel:N},[d("div",{class:X("wrapper"),style:t},[G("left",i),(c=s.default)==null?void 0:c.call(s),G("right",g)])])}}});const rt=H(ut);const dt={class:"cart"},kt={__name:"Cart",setup(e){const u=_([]),s=()=>{},m=()=>{},h=()=>{ge().then(a=>{u.value=a.data.filter(l=>l.product).map(l=>({...l,chk:!1}))})};h();const f=C({set(a){u.value.forEach(l=>l.chk=a)},get(){return u.value.every(a=>a.chk)}}),r=C(()=>u.value.filter(a=>a.chk).reduce((a,l)=>a+l.amount*l.product.price,0)*100),i=async(a,l)=>{await ve(a.product.id,l,a.product.price)},g=async a=>{await ke(a),Pe.success("\u5220\u9664\u6210\u529F"),h()};return(a,l)=>(j(),oe("div",dt,[(j(!0),oe(Fe,null,De(u.value,n=>(j(),Me(V(rt),null,{right:w(()=>[d(V(de),{square:"",text:"\u5220\u9664",onClick:o=>g(n.id),type:"danger",class:"delete-button"},null,8,["onClick"])]),default:w(()=>[d(V(We),{num:n.amount,price:n.product.price.toFixed(2),title:n.product.name,class:"goods-card",thumb:V(Ce)(n.product.coverImage)},{tag:w(()=>[d(V(ce),{modelValue:n.chk,"onUpdate:modelValue":o=>n.chk=o},null,8,["modelValue","onUpdate:modelValue"])]),footer:w(()=>[d(V(tt),{modelValue:n.amount,"onUpdate:modelValue":o=>n.amount=o,onMinus:o=>i(n,-1),onPlus:o=>i(n,1)},null,8,["modelValue","onUpdate:modelValue","onMinus","onPlus"])]),_:2},1032,["num","price","title","thumb"])]),_:2},1024))),256)),d(V(it),{price:V(r),"button-text":"\u63D0\u4EA4\u8BA2\u5355",onSubmit:m},{tip:w(()=>[ie(" \u4F60\u7684\u6536\u8D27\u5730\u5740\u4E0D\u652F\u6301\u914D\u9001, "),Re("span",{onClick:s},"\u4FEE\u6539\u5730\u5740")]),default:w(()=>[d(V(ce),{modelValue:V(f),"onUpdate:modelValue":l[0]||(l[0]=n=>Ge(f)?f.value=n:null)},{default:w(()=>[ie("\u5168\u9009")]),_:1},8,["modelValue"])]),_:1},8,["price"])]))}};export{kt as default};
